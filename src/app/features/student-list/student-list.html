<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
  
  <!-- Header & Controls -->
  <div class="p-6 border-b border-gray-200 dark:border-gray-700">
    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
      <div>
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-white">Student List</h2>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
          Showing {{ viewState().students.length }} of {{ viewState().totalElements }} students.
        </p>
      </div>
      <div class="w-full md:w-auto flex flex-col sm:flex-row gap-4">
        <!-- Search Input -->
        <div class="relative w-full sm:w-64">
          <span class="absolute inset-y-0 left-0 flex items-center pl-3">
            <i class="fa-solid fa-search text-gray-400"></i>
          </span>
          <input 
            type="text" 
            placeholder="Search by name, ID, email..."
            [ngModel]="filterText()"
            (ngModelChange)="onFilterChange($event)"
            class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"
          >
        </div>
        <!-- Status Filter -->
        <select 
          [ngModel]="statusFilter()"
          (ngModelChange)="onStatusChange($event)"
          class="w-full sm:w-auto px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"
        >
          <option value="active">Active Only</option>
          <option value="inactive">Inactive Only</option>
          <option value="all">All Students</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Table Container -->
  <div class="overflow-x-auto relative">
    <!-- Loading Overlay -->
    @if (viewState().loading) {
      <div class="absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center z-10">
        <i class="fa-solid fa-spinner fa-spin text-3xl text-blue-600"></i>
      </div>
    }

    <!-- Data Table -->
    <table class="min-w-full text-sm text-left text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th scope="col" class="table-header" (click)="onSortChange('studentId')">
            Student ID <app-sort-icon [currentSort]="sortBy()" [currentDir]="sortDir()" column="studentId"/>
          </th>
          <th scope="col" class="table-header" (click)="onSortChange('firstName')">
            Name <app-sort-icon [currentSort]="sortBy()" [currentDir]="sortDir()" column="firstName"/>
          </th>
          <th scope="col" class="table-header" (click)="onSortChange('email')">
            Email <app-sort-icon [currentSort]="sortBy()" [currentDir]="sortDir()" column="email"/>
          </th>
          <th scope="col" class="table-header" (click)="onSortChange('department')">
            Department <app-sort-icon [currentSort]="sortBy()" [currentDir]="sortDir()" column="department"/>
          </th>
          <th scope="col" class="px-6 py-3 text-center">Status</th>
          <th scope="col" class="px-6 py-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (student of viewState().students; track student.id) {
          <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
            <td class="px-6 py-4 font-mono text-gray-900 dark:text-white">{{ student.studentId }}</td>
            <td class="px-6 py-4 font-medium">{{ student.firstName }} {{ student.lastName }}</td>
            <td class="px-6 py-4">{{ student.email }}</td>
            <td class="px-6 py-4">{{ student.department | titlecase | replaceUnderscore }}</td>
            <td class="px-6 py-4 text-center">
              @if (student.active) {
                <span class="status-badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Active</span>
              } @else {
                <span class="status-badge bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Inactive</span>
              }
            </td>
            <td class="px-6 py-4 text-center space-x-4">
              <button (click)="onEdit(student)" class="action-icon text-blue-600 hover:text-blue-800" title="Edit">
                <i class="fa-solid fa-pencil"></i>
              </button>
              <button (click)="onToggleStatus(student)" class="action-icon" [ngClass]="student.active ? 'text-yellow-600 hover:text-yellow-800' : 'text-green-600 hover:text-green-800'" [title]="student.active ? 'Deactivate' : 'Activate'">
                <i class="fa-solid" [ngClass]="student.active ? 'fa-user-slash' : 'fa-user-check'"></i>
              </button>
            </td>
          </tr>
        } @empty {
          @if (!viewState().loading) {
            <tr>
              <td colspan="6" class="text-center py-10 text-gray-500">
                <i class="fa-solid fa-inbox text-3xl mb-2"></i>
                <p>No students found matching your criteria.</p>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination Footer -->
  @if (viewState().totalPages > 0) {
    <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between items-center gap-4">
      <!-- Page Size Selector -->
      <div class="flex items-center gap-2 text-sm">
        <span>Rows per page:</span>
        <select 
          [ngModel]="pageSize()"
          (ngModelChange)="onSizeChange($event)"
          class="px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"
        >
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
      </div>
      <!-- Page Info -->
      <span class="text-sm text-gray-700 dark:text-gray-400">
        Page <span class="font-semibold">{{ currentPage() + 1 }}</span> of <span class="font-semibold">{{ viewState().totalPages }}</span>
      </span>
      <!-- Page Navigation -->
      <div class="inline-flex mt-2 xs:mt-0">
        <button (click)="onPageChange(currentPage() - 1)" [disabled]="currentPage() === 0" class="pagination-btn rounded-l-md">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
        <button (click)="onPageChange(currentPage() + 1)" [disabled]="currentPage() + 1 >= viewState().totalPages" class="pagination-btn rounded-r-md border-l">
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    </div>
  }
</div>

<!-- Confirmation Dialog -->
@if (confirmDialogState().isOpen) {
  <app-confirmation-dialog 
    [title]="confirmDialogState().title!"
    [message]="confirmDialogState().message!"
    (confirm)="confirmDialogState().onConfirm!()"
    (cancel)="closeConfirmDialog()"
  />
}