<div class="max-w-3xl mx-auto">
  <a routerLink="/students" class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:underline mb-6">
    <i class="fa-solid fa-arrow-left mr-2"></i>
    Back to Student List
  </a>

  <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">
      {{ isEditMode ? 'Edit Student' : 'Add New Student' }}
    </h1>

    <form [formGroup]="studentForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Student ID -->
        <div>
          <label for="studentId" class="form-label">Student ID</label>
          <input type="text" id="studentId" formControlName="studentId" class="form-input" [class.is-invalid]="isControlInvalid('studentId')" [readOnly]="isEditMode">
          @if (getControl('studentId').hasError('required') && isControlInvalid('studentId')) {
            <p class="form-error">Student ID is required.</p>
          }
          @if (getControl('studentId').hasError('maxlength') && isControlInvalid('studentId')) {
            <p class="form-error">Student ID cannot exceed 100 characters.</p>
          }
        </div>

        <!-- Department -->
        <div>
          <label for="department" class="form-label">Department</label>
          <select id="department" formControlName="department" class="form-input" [class.is-invalid]="isControlInvalid('department')">
            <option [ngValue]="null" disabled>Select a department</option>
            @for (dept of departmentOptions; track dept.value) {
              <option [value]="dept.value">{{ dept.label }}</option>
            }
          </select>
          @if (isControlInvalid('department')) {
            <p class="form-error">Department is required.</p>
          }
        </div>

        <!-- First Name -->
        <div>
          <label for="firstName" class="form-label">First Name</label>
          <input type="text" id="firstName" formControlName="firstName" class="form-input" [class.is-invalid]="isControlInvalid('firstName')">
          @if (getControl('firstName').hasError('required') && isControlInvalid('firstName')) {
            <p class="form-error">First name is required.</p>
          }
          @if (getControl('firstName').hasError('minlength') && isControlInvalid('firstName')) {
            <p class="form-error">First name must be at least 2 characters.</p>
          }
          @if (getControl('firstName').hasError('pattern') && isControlInvalid('firstName')) {
            <p class="form-error">First name can only contain letters and spaces.</p>
          }
        </div>

        <!-- Last Name -->
        <div>
          <label for="lastName" class="form-label">Last Name</label>
          <input type="text" id="lastName" formControlName="lastName" class="form-input" [class.is-invalid]="isControlInvalid('lastName')">
          @if (getControl('lastName').hasError('required') && isControlInvalid('lastName')) {
            <p class="form-error">Last name is required.</p>
          }
           @if (getControl('lastName').hasError('minlength') && isControlInvalid('lastName')) {
            <p class="form-error">Last name must be at least 2 characters.</p>
          }
          @if (getControl('lastName').hasError('pattern') && isControlInvalid('lastName')) {
            <p class="form-error">Last name can only contain letters and spaces.</p>
          }
        </div>

        <!-- Email -->
        <div class="md:col-span-2">
          <label for="email" class="form-label">Email Address</label>
          <input type="email" id="email" formControlName="email" class="form-input" [class.is-invalid]="isControlInvalid('email')">
          @if (getControl('email').hasError('required') && isControlInvalid('email')) {
            <p class="form-error">Email is required.</p>
          }
          @if (getControl('email').hasError('email') && isControlInvalid('email')) {
            <p class="form-error">Please enter a valid email address.</p>
          }
        </div>
      </div>

      <!-- Submission Button -->
      <div class="mt-8 flex justify-end">
        <button type="submit" [disabled]="studentForm.invalid || state().status === 'submitting'" class="w-full md:w-auto bg-blue-600 text-white py-2.5 px-6 rounded-lg hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed flex items-center justify-center transition-colors">
          @if (state().status === 'submitting') {
            <i class="fa-solid fa-spinner fa-spin mr-2"></i>
            <span>Saving...</span>
          } @else {
            <span>{{ isEditMode ? 'Save Changes' : 'Add Student' }}</span>
          }
        </button>
      </div>
    </form>
  </div>

  <!-- Feedback Messages -->
  @if (state().status === 'success') {
    <div class="mt-4 p-4 bg-green-100 text-green-800 rounded-lg animate-fade-in">
      {{ state().message }}
    </div>
  }
  @if (state().status === 'error') {
    <div class="mt-4 p-4 bg-red-100 text-red-800 rounded-lg animate-fade-in">
      <strong>Error:</strong> {{ state().message }}
    </div>
  }
</div>